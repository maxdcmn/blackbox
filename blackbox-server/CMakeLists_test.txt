# CMakeLists for test_nvidia_apis
cmake_minimum_required(VERSION 3.15)
project(test-nvidia-apis)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Check for NVML
find_path(NVML_INCLUDE_DIR nvml.h
    PATHS
    /usr/include
    /usr/local/include
    /opt/nvidia/include
)

if(NVML_INCLUDE_DIR)
    message(STATUS "Found NVML: ${NVML_INCLUDE_DIR}")
    add_definitions(-DNVML_AVAILABLE)
    include_directories(${NVML_INCLUDE_DIR})
    find_library(NVML_LIB nvidia-ml
        PATHS
        /usr/lib
        /usr/lib64
        /usr/local/lib
    )
    if(NVML_LIB)
        message(STATUS "Found NVML library: ${NVML_LIB}")
    endif()
endif()

add_executable(test_nvidia_apis test_nvidia_apis.cpp)

if(NVML_LIB)
    target_link_libraries(test_nvidia_apis ${NVML_LIB})
endif()

